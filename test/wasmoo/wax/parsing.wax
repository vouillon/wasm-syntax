#[import = ("jslib", "wrap")]
fn wrap(&?any) -> &eq
#[import = ("jslib", "caml_string_of_jsstring")]
fn caml_string_of_jsstring(&eq) -> &eq
#[import = ("io", "caml_stderr")]
let caml_stderr: &eq
#[import = ("io", "caml_ml_open_descriptor_out")]
fn caml_ml_open_descriptor_out(&eq) -> &eq
#[import = ("io", "caml_ml_output")]
fn caml_ml_output(&eq, &eq, &eq, &eq) -> &eq
#[import = ("io", "caml_ml_flush")]
fn caml_ml_flush(&eq) -> &eq
#[import = ("ints", "caml_format_int")]
fn caml_format_int(&eq, &eq) -> &eq
#[import = ("float", "caml_format_float")]
fn caml_format_float(&eq, &eq) -> &eq
type float = { f: f64 }
type block = [mut &eq]
type string = [mut i8]
fn get(a: &eq, i: i32) -> i32 {
    let s: &string;
    s = a as &string;
    i = i + i;
    unreachable;
}
let caml_parser_trace: i32 = 0;
const ERRCODE: i32 = 256;
const START: i32 = 0;
const TOKEN_READ: i32 = 1;
const STACKS_GROWN_1: i32 = 2;
const STACKS_GROWN_2: i32 = 3;
const SEMANTIC_ACTION_COMPUTED: i32 = 4;
const ERROR_DETECTED: i32 = 5;
const loop_2: i32 = 6;
const testshift: i32 = 7;
const shift: i32 = 8;
const shift_recover: i32 = 9;
const reduce: i32 = 10;
const READ_TOKEN: i32 = 0;
const RAISE_PARSE_ERROR: i32 = 1;
const GROW_STACKS_1: i32 = 2;
const GROW_STACKS_2: i32 = 3;
const COMPUTE_SEMANTIC_ACTION: i32 = 4;
const CALL_ERROR_FUNCTION: i32 = 5;
const env_s_stack: i32 = 1;
const env_v_stack: i32 = 2;
const env_symb_start_stack: i32 = 3;
const env_symb_end_stack: i32 = 4;
const env_stacksize: i32 = 5;
const env_stackbase: i32 = 6;
const env_curr_char: i32 = 7;
const env_lval: i32 = 8;
const env_symb_start: i32 = 9;
const env_symb_end: i32 = 10;
const env_asp: i32 = 11;
const env_rule_len: i32 = 12;
const env_rule_number: i32 = 13;
const env_sp: i32 = 14;
const env_state: i32 = 15;
const env_errflag: i32 = 16;
const tbl_transl_const: i32 = 2;
const tbl_transl_block: i32 = 3;
const tbl_lhs: i32 = 4;
const tbl_len: i32 = 5;
const tbl_defred: i32 = 6;
const tbl_dgoto: i32 = 7;
const tbl_sindex: i32 = 8;
const tbl_rindex: i32 = 9;
const tbl_gindex: i32 = 10;
const tbl_tablesize: i32 = 11;
const tbl_table: i32 = 12;
const tbl_check: i32 = 13;
const tbl_names_const: i32 = 15;
const tbl_names_block: i32 = 16;
fn strlen(s: &string, p: i32) -> i32 {
    let i: i32;
    i = p;
    'loop: loop {
        if s[i] as i32_u != 0 { i = i + 1; br 'loop; }
    } /* 'loop */
    i - p;
}
fn token_name(vnames: &eq, number: i32) -> &eq {
    let names: &string;
    let i: i32;
    let len: i32;
    let name: &string;
    names = vnames as &string;
    'loop: loop {
        if !(names[i] as i32_u) { return string#"foo"; }
        if number != 0 {
            i = i + (strlen(names, i) + 1);
            number = number - 1;
            br 'loop;
        }
    } /* 'loop */
    len = strlen(names, i);
    name = [string|0; len];
    name.copy(0, names, i, len);
    name;
}
fn output(x: &eq) {
    let s: &string;
    s = x as &string;
    _ = caml_ml_output(caml_stderr, s, 0 as &i31, s.length as &i31);
}
fn output_nl() {
    _ = caml_ml_output(caml_stderr, string#"\n", 0 as &i31, 1 as &i31);
    _ = caml_ml_flush(caml_stderr);
}
fn output_int(x: i32) { output(caml_format_int(string#"%d", x as &i31)); }
fn print_token(tables: &block, state: i32, tok: &eq) {
    let b: &block;
    let v: &eq;
    if tok is &i31 {
        output(string#"foo");
        output_int(state);
        output(string#"foo");
        output(token_name(tables[tbl_names_const], tok as &i31 as i32_u));
        output_nl();
    } else {
        output(string#"foo");
        output_int(state);
        output(string#"foo");
        b = tok as &block;
        output(token_name(tables[tbl_names_block], b[0] as &i31 as i32_u));
        output(string#"(");
        v = b[1];
        if v is &i31 {
            output_int(v as &i31 as i32_s);
        } else {
            if v is &string {
                output(v);
            } else {
                if v is &float {
                    output(caml_format_float(string#"%g", v));
                } else { output(string#"_"); }
            }
        }
        output(string#")");
        output_nl();
    }
}
#[export = "caml_parse_engine"]
fn caml_parse_engine(vtables: &eq, venv: &eq, vcmd: &eq, varg: &eq) -> &eq {
    let res: i32;
    let n: i32;
    let n1: i32;
    let n2: i32;
    let m: i32;
    let state1: i32;
    let sp: i32;
    let asp: i32;
    let state: i32;
    let errflag: i32;
    let tables: &block;
    let env: &block;
    let cmd: i32;
    let arg: &block;
    let tbl_defred_2: &string;
    let tbl_sindex_2: &string;
    let tbl_check_2: &string;
    let tbl_rindex_2: &string;
    let tbl_table_2: &string;
    let tbl_len_2: &string;
    let tbl_lhs_2: &string;
    let tbl_gindex_2: &string;
    let tbl_dgoto_2: &string;
    tables = vtables as &block;
    tbl_defred_2 = tables[tbl_defred] as &string;
    tbl_sindex_2 = tables[tbl_sindex] as &string;
    tbl_check_2 = tables[tbl_check] as &string;
    tbl_rindex_2 = tables[tbl_rindex] as &string;
    tbl_table_2 = tables[tbl_table] as &string;
    tbl_len_2 = tables[tbl_len] as &string;
    tbl_lhs_2 = tables[tbl_lhs] as &string;
    tbl_gindex_2 = tables[tbl_gindex] as &string;
    tbl_dgoto_2 = tables[tbl_dgoto] as &string;
    env = venv as &block;
    cmd = vcmd as &i31 as i32_s;
    sp = env[env_sp] as &i31 as i32_s;
    state = env[env_state] as &i31 as i32_s;
    errflag = env[env_errflag] as &i31 as i32_s;
    'exit: {
        'next: loop {
            'default: {
                'SEMANTIC_ACTION_COMPUTED: {
                    'STACKS_GROWN_2: {
                        'reduce: {
                            'STACKS_GROWN_1: {
                                'shift_recover: {
                                    'shift: {
                                        'ERROR_DETECTED: {
                                            'testshift: {
                                                'TOKEN_READ: {
                                                    'loop: {
                                                        'START: {
                                                            br_table
                                                                [ 'START
                                                                    'TOKEN_READ
                                                                    'STACKS_GROWN_1
                                                                    'STACKS_GROWN_2
                                                                    'SEMANTIC_ACTION_COMPUTED
                                                                    'ERROR_DETECTED
                                                                    'loop
                                                                    'testshift
                                                                    'shift
                                                                    'shift_recover
                                                                    'reduce
                                                                    else
                                                                    'default
                                                                    ]
                                                                cmd;
                                                        }
                                                        state = 0;
                                                        errflag = 0;
                                                    } /* 'loop */
                                                    n =
                                                        get
                                                            (tbl_defred_2,
                                                             state);
                                                    if n != 0 {
                                                        cmd = reduce;
                                                        br 'next;
                                                    }
                                                    if
                                                        env[env_curr_char]
                                                            as &i31 as i32_s
                                                            >=s 0
                                                    {
                                                        cmd = testshift;
                                                        br 'next;
                                                    }
                                                    res = READ_TOKEN;
                                                    br 'exit;
                                                } /* 'TOKEN_READ */
                                                'cont: {
                                                    _ =
                                                        'not_block: do &eq {
                                                            arg =
                                                                br_on_cast_fail
                                                                    'not_block
                                                                    &block
                                                                    varg;
                                                            env
                                                                [env_curr_char]
                                                                =
                                                                (tables
                                                                    [tbl_transl_block]
                                                                    as &block)
                                                                    [
                                                                    arg[0]
                                                                    as &i31
                                                                    as i32_u
                                                                    + 1];
                                                            env[env_lval] =
                                                                arg[1];
                                                            br 'cont;
                                                        };
                                                    env[env_curr_char] =
                                                        (tables
                                                             [tbl_transl_const]
                                                             as &block)
                                                            [varg as &i31
                                                                 as i32_u + 1];
                                                    env[env_lval] = 0 as &i31;
                                                }
                                                if caml_parser_trace {
                                                    print_token
                                                        (tables, state, varg);
                                                }
                                            } /* 'testshift */
                                            n1 = get(tbl_sindex_2, state);
                                            n2 =
                                                n1 +
                                                    env[env_curr_char]
                                                        as &i31 as i32_s;
                                            if (n1 != 0) & (n2 >=s 0) {
                                                if
                                                    n2 <=s
                                                        tables[tbl_tablesize]
                                                            as &i31 as i32_s
                                                {
                                                    if
                                                        get(tbl_check_2, n2)
                                                            as &i31 ==
                                                            env
                                                                [env_curr_char]
                                                    {
                                                        cmd = shift;
                                                        br 'next;
                                                    }
                                                }
                                            }
                                            n1 = get(tbl_rindex_2, state);
                                            n2 =
                                                n1 +
                                                    env[env_curr_char]
                                                        as &i31 as i32_s;
                                            if (n1 != 0) & (n2 >=s 0) {
                                                if
                                                    n2 <=s
                                                        tables[tbl_tablesize]
                                                            as &i31 as i32_s
                                                {
                                                    if
                                                        get(tbl_check_2, n2)
                                                            as &i31 ==
                                                            env
                                                                [env_curr_char]
                                                    {
                                                        n =
                                                            get
                                                                (tbl_table_2,
                                                                 n2);
                                                        cmd = reduce;
                                                        br 'next;
                                                    }
                                                }
                                            }
                                            if errflag <=s 0 {
                                                res = CALL_ERROR_FUNCTION;
                                                br 'exit;
                                            }
                                        } /* 'ERROR_DETECTED */
                                        if errflag <s 3 {
                                            errflag = 3;
                                            'loop2: loop {
                                                state1 =
                                                    (env[env_s_stack]
                                                         as &block)
                                                        [sp + 1] as &i31
                                                        as i32_s;
                                                n1 =
                                                    get(tbl_sindex_2, state1);
                                                n2 = n1 + ERRCODE;
                                                if (n1 != 0) & (n2 >=s 0) {
                                                    if
                                                        n2 <=s
                                                            tables
                                                                [tbl_tablesize]
                                                                as &i31
                                                                as i32_s
                                                    {
                                                        if
                                                            get
                                                                (tbl_check_2,
                                                                 n2)
                                                                == ERRCODE
                                                        {
                                                            if
                                                                caml_parser_trace
                                                            {
                                                                output
                                                                    (
                                                                    string#"foo");
                                                                output_int
                                                                    (
                                                                    state1);
                                                                output_nl();
                                                            }
                                                            cmd =
                                                                shift_recover;
                                                            br 'next;
                                                        }
                                                    }
                                                }
                                                if caml_parser_trace {
                                                    output(string#"foo");
                                                    output_int(state1);
                                                    output_nl();
                                                }
                                                if
                                                    sp <=s
                                                        env[env_stackbase]
                                                            as &i31 as i32_s
                                                {
                                                    if caml_parser_trace {
                                                        output(string#"foo");
                                                        output_nl();
                                                    }
                                                    return
                                                        RAISE_PARSE_ERROR
                                                            as &i31;
                                                }
                                                sp = sp - 1;
                                                br 'loop2;
                                            } /* 'loop2 */
                                        } else {
                                            if
                                                env[env_curr_char] ==
                                                    0 as &i31
                                            {
                                                return
                                                    RAISE_PARSE_ERROR as &i31;
                                            }
                                            if caml_parser_trace {
                                                output(string#"foo");
                                                output_nl();
                                            }
                                            env[env_curr_char] = -1 as &i31;
                                            cmd = loop_2;
                                            br 'next;
                                        }
                                    } /* 'shift */
                                    env[env_curr_char] = -1 as &i31;
                                    if errflag >s 0 {
                                        errflag = errflag - 1;
                                    }
                                } /* 'shift_recover */
                                if caml_parser_trace {
                                    output(string#"foo");
                                    output_int(state);
                                    output(string#"foo");
                                    output_int(get(tbl_table_2, n2));
                                    output_nl();
                                }
                                state = get(tbl_table_2, n2);
                                sp = sp + 1;
                                if sp >=s env[env_stacksize] as &i31 as i32_s
                                {
                                    res = GROW_STACKS_1;
                                    br 'exit;
                                }
                            } /* 'STACKS_GROWN_1 */
                            (env[env_s_stack] as &block)[sp + 1] =
                                state as &i31;
                            (env[env_v_stack] as &block)[sp + 1] =
                                env[env_lval];
                            (env[env_symb_start_stack] as &block)[sp + 1] =
                                env[env_symb_start];
                            (env[env_symb_end_stack] as &block)[sp + 1] =
                                env[env_symb_end];
                            cmd = loop_2;
                            br 'next;
                        } /* 'reduce */
                        if caml_parser_trace {
                            output(string#"foo");
                            output_int(state);
                            output(string#"foo");
                            output_int(n);
                            output_nl();
                        }
                        m = get(tbl_len_2, n);
                        env[env_asp] = sp as &i31;
                        env[env_rule_number] = n as &i31;
                        env[env_rule_len] = m as &i31;
                        sp = sp + (1 - m);
                        m = get(tbl_lhs_2, n);
                        state1 =
                            (env[env_s_stack] as &block)[sp] as &i31 as i32_s;
                        n1 = get(tbl_gindex_2, m);
                        n2 = n1 + state1;
                        'cont: {
                            if (n1 != 0) & (n2 >=s 0) {
                                if
                                    n2 <=s
                                        tables[tbl_tablesize] as &i31
                                            as i32_s
                                {
                                    if get(tbl_check_2, n2) == state1 {
                                        state = get(tbl_table_2, n2);
                                        br 'cont;
                                    }
                                }
                            }
                            state = get(tbl_dgoto_2, m);
                        } /* 'cont */
                        if sp >=s env[env_stacksize] as &i31 as i32_s {
                            res = GROW_STACKS_2;
                            br 'exit;
                        }
                    } /* 'STACKS_GROWN_2 */
                    res = COMPUTE_SEMANTIC_ACTION;
                    br 'exit;
                } /* 'SEMANTIC_ACTION_COMPUTED */
                (env[env_s_stack] as &block)[sp + 1] = state as &i31;
                (env[env_v_stack] as &block)[sp + 1] = varg;
                asp = env[env_asp] as &i31 as i32_s;
                (env[env_symb_end_stack] as &block)[sp + 1] =
                    (env[env_symb_end_stack] as &block)[asp + 1];
                if sp >s asp {
                    (env[env_symb_start_stack] as &block)[sp + 1] =
                        (env[env_symb_end_stack] as &block)[asp + 1];
                }
                cmd = loop_2;
                br 'next;
            } /* 'default */
            return RAISE_PARSE_ERROR as &i31;
        } /* 'next */
    } /* 'exit */
    env[env_sp] = sp as &i31;
    env[env_state] = state as &i31;
    env[env_errflag] = errflag as &i31;
    res as &i31;
}
#[export = "caml_set_parser_trace"]
fn caml_set_parser_trace(x: &eq) -> &eq {
    let oldflag: i32;
    oldflag = caml_parser_trace;
    caml_parser_trace = x as &i31 as i32_s;
    oldflag as &i31;
}
